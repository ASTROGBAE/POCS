<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>panoptes.weather.AAGCloudSensor &mdash; POCS 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="POCS 0.1.1 documentation" href="../../../index.html" />
    <link rel="up" title="panoptes" href="../../panoptes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">POCS 0.1.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../panoptes.html" accesskey="U">panoptes</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for panoptes.weather.AAGCloudSensor</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">astropy.table</span> <span class="kn">as</span> <span class="nn">table</span>
<span class="kn">import</span> <span class="nn">astropy.io.ascii</span> <span class="kn">as</span> <span class="nn">ascii</span>

<span class="kn">from</span> <span class="nn">panoptes.utils</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">panoptes.weather</span> <span class="kn">import</span> <span class="n">WeatherStation</span>


<span class="nd">@logger.has_logger</span>
<div class="viewcode-block" id="AAGCloudSensor"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor">[docs]</a><span class="k">class</span> <span class="nc">AAGCloudSensor</span><span class="p">(</span><span class="n">WeatherStation</span><span class="o">.</span><span class="n">WeatherStation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is for the AAG Cloud Sensor device which can be communicated with</span>
<span class="sd">    via serial commands.</span>

<span class="sd">    http://www.aagware.eu/aag/cloudwatcherNetwork/TechInfo/Rs232_Comms_v100.pdf</span>
<span class="sd">    http://www.aagware.eu/aag/cloudwatcherNetwork/TechInfo/Rs232_Comms_v110.pdf</span>
<span class="sd">    http://www.aagware.eu/aag/cloudwatcherNetwork/TechInfo/Rs232_Comms_v120.pdf</span>

<span class="sd">    Command List (from Rs232_Comms_v100.pdf)</span>
<span class="sd">    !A = Get internal name (recieves 2 blocks)</span>
<span class="sd">    !B = Get firmware version (recieves 2 blocks)</span>
<span class="sd">    !C = Get values (recieves 5 blocks)</span>
<span class="sd">         Zener voltage, Ambient Temperature, Ambient Temperature, Rain Sensor Temperature, HSB</span>
<span class="sd">    !D = Get internal errors (recieves 5 blocks)</span>
<span class="sd">    !E = Get rain frequency (recieves 2 blocks)</span>
<span class="sd">    !F = Get switch status (recieves 2 blocks)</span>
<span class="sd">    !G = Set switch open (recieves 2 blocks)</span>
<span class="sd">    !H = Set switch closed (recieves 2 blocks)</span>
<span class="sd">    !Pxxxx = Set PWM value to xxxx (recieves 2 blocks)</span>
<span class="sd">    !Q = Get PWM value (recieves 2 blocks)</span>
<span class="sd">    !S = Get sky IR temperature (recieves 2 blocks)</span>
<span class="sd">    !T = Get sensor temperature (recieves 2 blocks)</span>
<span class="sd">    !z = Reset RS232 buffer pointers (recieves 1 blocks)</span>
<span class="sd">    !K = Get serial number (recieves 2 blocks)</span>

<span class="sd">    Return Codes</span>
<span class="sd">    &#39;1 &#39;    Infra red temperature in hundredth of degree Celsius</span>
<span class="sd">    &#39;2 &#39;    Infra red sensor temperature in hundredth of degree Celsius</span>
<span class="sd">    &#39;3 &#39;    Analog0 output 0-1023 =&gt; 0 to full voltage (Ambient Temp NTC)</span>
<span class="sd">    &#39;4 &#39;    Analog2 output 0-1023 =&gt; 0 to full voltage (LDR ambient light)</span>
<span class="sd">    &#39;5 &#39;    Analog3 output 0-1023 =&gt; 0 to full voltage (Rain Sensor Temp NTC)</span>
<span class="sd">    &#39;6 &#39;    Analog3 output 0-1023 =&gt; 0 to full voltage (Zener Voltage reference)</span>
<span class="sd">    &#39;E1&#39;    Number of internal errors reading infra red sensor: 1st address byte</span>
<span class="sd">    &#39;E2&#39;    Number of internal errors reading infra red sensor: command byte</span>
<span class="sd">    &#39;E3&#39;    Number of internal errors reading infra red sensor: 2nd address byte</span>
<span class="sd">    &#39;E4&#39;    Number of internal errors reading infra red sensor: PEC byte NB: the error counters are reset after being read.</span>
<span class="sd">    &#39;N &#39;    Internal Name</span>
<span class="sd">    &#39;V &#39;    Firmware Version number</span>
<span class="sd">    &#39;Q &#39;    PWM duty cycle</span>
<span class="sd">    &#39;R &#39;    Rain frequency counter</span>
<span class="sd">    &#39;X &#39;    Switch Opened</span>
<span class="sd">    &#39;Y &#39;    Switch Closed</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serial_address</span><span class="o">=</span><span class="s">&#39;/dev/ttyS0&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="c">## Initialize Serial Connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Using serial address: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serial_address</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">serial_address</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Connecting to AAG Cloud Sensor&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">serial_address</span><span class="p">,</span> <span class="mi">9600</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Connected to Cloud Sensor on {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serial_address</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Unable to connect to AAG Cloud Sensor&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;  {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;  {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to AAG Cloud Sensor&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">## Initialize Values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ambient_temp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sky_temp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_voltage</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LDR_resistance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rain_sensor_temp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">## Table Info (add custom dtypes to values in WeatherStation class)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Ambient Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Sky Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Wind Speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Internal Voltage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;LDR Resistance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;PWM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;i4&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Switch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;S6&#39;</span>
        <span class="c">## Command Translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;!A&#39;</span><span class="p">:</span> <span class="s">&#39;Get internal name&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!B&#39;</span><span class="p">:</span> <span class="s">&#39;Get firmware version&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!C&#39;</span><span class="p">:</span> <span class="s">&#39;Get values&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!D&#39;</span><span class="p">:</span> <span class="s">&#39;Get internal errors&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!E&#39;</span><span class="p">:</span> <span class="s">&#39;Get rain frequency&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!F&#39;</span><span class="p">:</span> <span class="s">&#39;Get switch status&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!G&#39;</span><span class="p">:</span> <span class="s">&#39;Set switch open&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!H&#39;</span><span class="p">:</span> <span class="s">&#39;Set switch closed&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!Pxxxx&#39;</span><span class="p">:</span> <span class="s">&#39;Set PWM value to xxxx&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!Q&#39;</span><span class="p">:</span> <span class="s">&#39;Get PWM value&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!S&#39;</span><span class="p">:</span> <span class="s">&#39;Get sky IR temperature&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!T&#39;</span><span class="p">:</span> <span class="s">&#39;Get sensor temperature&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!z&#39;</span><span class="p">:</span> <span class="s">&#39;Reset RS232 buffer pointers&#39;</span><span class="p">,</span>
                         <span class="s">&#39;!K&#39;</span><span class="p">:</span> <span class="s">&#39;Get serial number&#39;</span><span class="p">,</span>
                         <span class="s">&#39;v!&#39;</span><span class="p">:</span> <span class="s">&#39;Query if anemometer enabled&#39;</span><span class="p">,</span>
                         <span class="s">&#39;V!&#39;</span><span class="p">:</span> <span class="s">&#39;Get wind speed&#39;</span><span class="p">,</span>
                         <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span><span class="p">:</span>
            <span class="c">## Clear Serial Buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">()</span>
            <span class="c">## Query Device Name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!A&#39;</span><span class="p">,</span> <span class="s">&#39;!N&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Device Name is &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="c">## Query Firmware Version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">firmware_version</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!B&#39;</span><span class="p">,</span> <span class="s">&#39;!V&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Firmware Version = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firmware_version</span><span class="p">))</span>
            <span class="c">## Query Serial Number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!K&#39;</span><span class="p">,</span> <span class="s">&#39;!K(\d{4})([\w\s\d]{8})&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Serial Number: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span><span class="p">))</span>


<div class="viewcode-block" id="AAGCloudSensor.clear_buffer"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.clear_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">clear_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clear response buffer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#             self.logger.debug(&#39;Clearing Buffer: {0}&#39;.format(contents))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Cleared {} bytes from buffer&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.query"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.query">[docs]</a>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">expects</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generic query for the AAG cloud sensor.  Give the string indicating the</span>
<span class="sd">        type of query and the string which you expect to match in the return.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_buffer</span><span class="p">()</span>
        <span class="c">## Figure out what patterns to look for in response</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expects</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c">## If expects is a long string, it must be the full pattern</span>
                <span class="n">ResponsePatterns</span> <span class="o">=</span> <span class="p">{</span><span class="n">expects</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span> <span class="n">expects</span><span class="p">}</span>
                <span class="n">expects</span> <span class="o">=</span> <span class="p">[</span><span class="n">expects</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">## If expects is a short string, it is just the leading flag characters</span>
                <span class="n">ResponsePatterns</span> <span class="o">=</span> <span class="p">{</span><span class="n">expects</span><span class="p">:</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expects</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;\!&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;([\s\w\d\.]{13})&#39;</span><span class="p">}</span>
                <span class="n">expects</span> <span class="o">=</span> <span class="p">[</span><span class="n">expects</span><span class="p">]</span>
            <span class="c">## In either case, also look for HSB</span>
            <span class="n">ResponsePatterns</span><span class="p">[</span><span class="s">&#39;HSB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;\!&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;\s{12}0&#39;</span>
            <span class="n">expects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;HSB&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">expects</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expects</span><span class="p">)</span>
            <span class="n">expects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;HSB&#39;</span><span class="p">)</span>
            <span class="n">ResponsePatterns</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">expects</span><span class="p">:</span>
                <span class="n">ResponsePatterns</span><span class="p">[</span><span class="n">expect</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expect</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;\!&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;([\s\w\d\.]{&#39;</span><span class="o">+</span><span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">15</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">expect</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;})&#39;</span>
            <span class="n">ResponsePatterns</span><span class="p">[</span><span class="s">&#39;HSB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;\!&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;\s{12}0&#39;</span>

        <span class="c">## Send command</span>
        <span class="k">if</span> <span class="n">send</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Sending command: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="n">send</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Sending unknown command&#39;</span><span class="p">)</span>
        <span class="n">send</span> <span class="o">=</span> <span class="n">send</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">nBytes</span> <span class="o">=</span> <span class="n">nResponses</span><span class="o">*</span><span class="mi">15</span>
        <span class="n">complete_result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">complete_result</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Sending: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">send</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AAG</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="n">responseString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AAG</span><span class="o">.</span><span class="n">read</span><span class="p">((</span><span class="n">nResponses</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span><span class="p">),</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">response_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nResponses</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">response_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">responseString</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">15</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Response: &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">responseString</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">15</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span><span class="p">]))</span>

            <span class="c">## Look for expected responses</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">response_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">expects</span><span class="p">:</span>
                    <span class="n">IsMatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ResponsePatterns</span><span class="p">[</span><span class="n">expect</span><span class="p">],</span> <span class="n">response</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">IsMatch</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Found match to {:&gt;3s}: &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expect</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">expect</span> <span class="o">!=</span> <span class="s">&#39;HSB&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">expect</span><span class="p">]</span> <span class="o">=</span> <span class="n">IsMatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">checklist</span> <span class="o">=</span> <span class="p">[</span><span class="n">expect</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">expects</span> <span class="k">if</span> <span class="n">expect</span> <span class="o">!=</span> <span class="s">&#39;HSB&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">checklist</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Found all expected results&#39;</span><span class="p">)</span>
                <span class="n">complete_result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Did not find all expected results&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tries</span> <span class="o">&gt;=</span> <span class="n">max_tries</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Did not find all expected results after {} tries&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_tries</span><span class="p">))</span>
                    <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">nResponses</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">complete_result</span><span class="p">[</span><span class="n">expects</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">complete_result</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.query_int_median"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.query_int_median">[docs]</a>    <span class="k">def</span> <span class="nf">query_int_median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">navg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wrapper around the query method which assumes the result is an integer</span>
<span class="sd">        and which queries five times and medians the result and return that.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">navg</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">send</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="n">max_tries</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">clip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1022</span><span class="p">:</span> <span class="n">response</span> <span class="o">=</span> <span class="mi">1022</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">response</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">navg</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Queried {} {} {} times and result was {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">send</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">navg</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">value</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_ambient_temperature"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_ambient_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_ambient_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.ambient_temp property</span>
<span class="sd">        </span>
<span class="sd">        Calculation is taken from Rs232_Comms_v100.pdf section &quot;Converting values</span>
<span class="sd">        sent by the device to meaningful units&quot; item 5.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_int_median</span><span class="p">(</span><span class="s">&#39;!T&#39;</span><span class="p">,</span> <span class="s">&#39;!2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ambient_temp</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Ambient Temperature = {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ambient_temp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ambient_temp</span> <span class="o">=</span> <span class="bp">None</span>



</div>
<div class="viewcode-block" id="AAGCloudSensor.get_sky_temperature"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_sky_temperature">[docs]</a>    <span class="k">def</span> <span class="nf">get_sky_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.sky_temp property</span>
<span class="sd">        </span>
<span class="sd">        Calculation is taken from Rs232_Comms_v100.pdf section &quot;Converting values</span>
<span class="sd">        sent by the device to meaningful units&quot; item 1.</span>
<span class="sd">        </span>
<span class="sd">        Does this n times as recommended by the &quot;Communication operational </span>
<span class="sd">        recommendations&quot; section in Rs232_Comms_v100.pdf</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_int_median</span><span class="p">(</span><span class="s">&#39;!S&#39;</span><span class="p">,</span> <span class="s">&#39;!1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sky_temp</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Sky Temperature = {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sky_temp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sky_temp</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_rain_frequency"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_rain_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">get_rain_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.rain_frequency property</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_int_median</span><span class="p">(</span><span class="s">&#39;!E&#39;</span><span class="p">,</span> <span class="s">&#39;!R&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rain_frequency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.</span> <span class="o">/</span> <span class="mf">1023.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Rain Frequency = {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rain_frequency</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rain_frequency</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_PWM"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_PWM">[docs]</a>    <span class="k">def</span> <span class="nf">get_PWM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.PWM property.</span>
<span class="sd">        </span>
<span class="sd">        Calculation is taken from Rs232_Comms_v100.pdf section &quot;Converting values</span>
<span class="sd">        sent by the device to meaningful units&quot; item 3.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_int_median</span><span class="p">(</span><span class="s">&#39;!Q&#39;</span><span class="p">,</span> <span class="s">&#39;!Q&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.</span> <span class="o">/</span> <span class="mf">1023.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;PWM Value = {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PWM</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_values"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.internal_voltage, self.LDR_resistance, and </span>
<span class="sd">        self.rain_sensor_temp properties</span>
<span class="sd">        </span>
<span class="sd">        Calculation is taken from Rs232_Comms_v100.pdf section &quot;Converting values</span>
<span class="sd">        sent by the device to meaningful units&quot; items 4, 6, 7.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ZenerConstant</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">LDRPullupResistance</span> <span class="o">=</span> <span class="mf">56.</span>
        <span class="n">RainPullUpResistance</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">RainResAt25</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">RainBeta</span> <span class="o">=</span> <span class="mf">3450.</span>
        <span class="n">ABSZERO</span> <span class="o">=</span> <span class="mf">273.15</span>
        <span class="n">internal_voltages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">LDR_resistances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rain_sensor_temps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">responses</span> <span class="o">=</span> <span class="n">AAG</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;!6&#39;</span><span class="p">,</span> <span class="s">&#39;!4&#39;</span><span class="p">,</span> <span class="s">&#39;!5&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">responses</span><span class="p">:</span>
                <span class="n">internal_voltage</span> <span class="o">=</span> <span class="mi">1023</span> <span class="o">*</span> <span class="n">ZenerConstant</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">responses</span><span class="p">[</span><span class="s">&#39;!6&#39;</span><span class="p">])</span>
                <span class="n">internal_voltages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">internal_voltage</span><span class="p">)</span>
                <span class="n">LDR_resistance</span> <span class="o">=</span> <span class="n">LDRPullupResistance</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1023.</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">responses</span><span class="p">[</span><span class="s">&#39;!4&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
                <span class="n">LDR_resistances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LDR_resistance</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">RainPullUpResistance</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1023.</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">responses</span><span class="p">[</span><span class="s">&#39;!5&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">RainResAt25</span><span class="p">)</span>
                <span class="n">rain_sensor_temp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">RainBeta</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">ABSZERO</span> <span class="o">+</span> <span class="mf">25.</span><span class="p">))</span>
                <span class="n">rain_sensor_temps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rain_sensor_temp</span><span class="p">)</span>
        <span class="c">## Median Results</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">internal_voltages</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">internal_voltage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">internal_voltages</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">volt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Internal Voltage = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_voltage</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">internal_voltage</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">LDR_resistances</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LDR_resistance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">LDR_resistances</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kiloohm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;LDR Resistance = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LDR_resistance</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LDR_resistance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rain_sensor_temps</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rain_sensor_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rain_sensor_temps</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Rain Sensor Temp = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rain_sensor_temp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rain_sensor_temp</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_errors"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_errors">[docs]</a>    <span class="k">def</span> <span class="nf">get_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.IR_errors property</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">AAG</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!D&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;!E1&#39;</span><span class="p">,</span> <span class="s">&#39;!E2&#39;</span><span class="p">,</span> <span class="s">&#39;!E3&#39;</span><span class="p">,</span> <span class="s">&#39;!E4&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;!E1&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E1&#39;</span><span class="p">])),</span>
                           <span class="s">&#39;!E2&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E2&#39;</span><span class="p">])),</span>
                           <span class="s">&#39;!E3&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E3&#39;</span><span class="p">])),</span>
                           <span class="s">&#39;!E4&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E4&#39;</span><span class="p">]))</span> <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Internal Error 1: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E1&#39;</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Internal Error 2: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E2&#39;</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Internal Error 3: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E3&#39;</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Internal Error 4: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;!E4&#39;</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;!E1&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="s">&#39;!E2&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="s">&#39;!E3&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="s">&#39;!E4&#39;</span><span class="p">:</span> <span class="bp">None</span> <span class="p">}</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_switch"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_switch">[docs]</a>    <span class="k">def</span> <span class="nf">get_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.switch property</span>
<span class="sd">        </span>
<span class="sd">        Unlike other queries, this method has to check if the return matches a</span>
<span class="sd">        !X or !Y pattern (indicating open and closed respectively) rather than</span>
<span class="sd">        read a value.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">max_tries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">query_open</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!F&#39;</span><span class="p">,</span> <span class="s">&#39;!X&#39;</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">query_closed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;!F&#39;</span><span class="p">,</span> <span class="s">&#39;!Y&#39;</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query_open</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">query_closed</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;OPEN&#39;</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">query_open</span> <span class="ow">and</span> <span class="n">query_closed</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;CLOSED&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="ow">and</span> <span class="n">tries</span> <span class="o">&gt;=</span> <span class="n">max_tries</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;UNKNOWN&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Switch Status = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.wind_speed_enabled"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.wind_speed_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">wind_speed_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Method returns true or false depending on whether the device supports</span>
<span class="sd">        wind speed measurements.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;v!&#39;</span><span class="p">,</span> <span class="s">&#39;!v&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Anemometer enabled&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Anemometer not enabled&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Anemometer not enabled&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.get_wind_speed"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.get_wind_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populates the self.wind_speed property</span>
<span class="sd">        </span>
<span class="sd">        Based on the information in Rs232_Comms_v120.pdf document</span>
<span class="sd">        </span>
<span class="sd">        Medians 5 measurements.  This isn&#39;t mentioned specifically by the manual</span>
<span class="sd">        but I&#39;m guessing it won&#39;t hurt.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">AAG</span><span class="o">.</span><span class="n">wind_speed_enabled</span><span class="p">():</span>
            <span class="n">WindSpeeds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;V!&#39;</span><span class="p">,</span> <span class="s">&#39;!w&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                    <span class="n">WindSpeeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">WindSpeeds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">WindSpeeds</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Wind speed = {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.update_weather"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.update_weather">[docs]</a>    <span class="k">def</span> <span class="nf">update_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Queries the values for writing to the telemetry file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_ambient_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_sky_temperature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_wind_speed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_rain_frequency</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_PWM</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_errors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_switch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_safety_decision</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_telemetry_files</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.read_AAG_telemetry"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.read_AAG_telemetry">[docs]</a>    <span class="k">def</span> <span class="nf">read_AAG_telemetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">telemetry</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                               <span class="n">format</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span>
                               <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="s">&#39;Safe&#39;</span><span class="p">,</span> <span class="s">&#39;Ambient Temperature&#39;</span><span class="p">,</span> <span class="s">&#39;Sky Temperature&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;Rain Frequency&#39;</span><span class="p">,</span> <span class="s">&#39;Wind Speed&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;Internal Voltage&#39;</span><span class="p">,</span> <span class="s">&#39;LDR Resistance&#39;</span><span class="p">,</span> <span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">,</span> <span class="s">&#39;PWM&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;E1&#39;</span><span class="p">,</span> <span class="s">&#39;E2&#39;</span><span class="p">,</span> <span class="s">&#39;E3&#39;</span><span class="p">,</span> <span class="s">&#39;E4&#39;</span><span class="p">,</span> <span class="s">&#39;Switch&#39;</span><span class="p">),</span>
                               <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Safe&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Safe&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Ambient Temperature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Ambient Temperature&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Sky Temperature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Sky Temperature&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Rain Frequency&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Frequency&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Wind Speed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Wind Speed&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Internal Voltage&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Internal Voltage&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;LDR Resistance&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;LDR Resistance&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;PWM&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;PWM&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;E1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E1&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;E2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E2&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;E3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E3&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;E4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E4&#39;</span><span class="p">])],</span>
                                           <span class="s">&#39;Switch&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Switch&#39;</span><span class="p">])]</span> <span class="p">}</span>
                              <span class="p">)</span>
        <span class="k">return</span> <span class="n">telemetry</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.update_telemetry_files"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.update_telemetry_files">[docs]</a>    <span class="k">def</span> <span class="nf">update_telemetry_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">## First, write file with only timestamp and SAFE/UNSAFE condition</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition_file</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Opening prior conditions file: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition_file</span><span class="p">))</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition_file</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                         <span class="n">format</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span>
                                         <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">])],</span>
                                                     <span class="s">&#39;Safe&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Safe&#39;</span><span class="p">])]}</span>
                                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;No prior conditions file found.  Generating new table.&#39;</span><span class="p">)</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="s">&#39;Safe&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Safe&#39;</span><span class="p">]))</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S UT&#39;</span><span class="p">),</span>
                   <span class="s">&#39;Safe&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">safe</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Adding new row to table&#39;</span><span class="p">)</span>
        <span class="n">conditions</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Writing modified table to: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition_file</span><span class="p">))</span>
        <span class="n">ascii</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition_file</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">)</span>

        <span class="c">## Second, write file with all data</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Opening prior telemetry file: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">))</span>
            <span class="n">telemetry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_AAG_telemetry</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;No prior telemetry file found.  Generating new table.&#39;</span><span class="p">)</span>
            <span class="n">telemetry</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="s">&#39;Safe&#39;</span><span class="p">,</span>
                                           <span class="s">&#39;Ambient Temperature&#39;</span><span class="p">,</span> <span class="s">&#39;Sky Temperature&#39;</span><span class="p">,</span> <span class="s">&#39;Rain Frequency&#39;</span><span class="p">,</span> <span class="s">&#39;Wind Speed&#39;</span><span class="p">,</span> 
                                           <span class="s">&#39;Internal Voltage&#39;</span><span class="p">,</span> <span class="s">&#39;LDR Resistance&#39;</span><span class="p">,</span> <span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">,</span> <span class="s">&#39;PWM&#39;</span><span class="p">,</span>
                                           <span class="s">&#39;E1&#39;</span><span class="p">,</span> <span class="s">&#39;E2&#39;</span><span class="p">,</span> <span class="s">&#39;E3&#39;</span><span class="p">,</span> <span class="s">&#39;E4&#39;</span><span class="p">,</span> <span class="s">&#39;Switch&#39;</span><span class="p">),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Safe&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Ambient Temperature&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Sky Temperature&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Frequency&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Wind Speed&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Internal Voltage&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;LDR Resistance&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;PWM&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E1&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E2&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E3&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;E4&#39;</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">table_dtypes</span><span class="p">[</span><span class="s">&#39;Switch&#39;</span><span class="p">])</span>
                                    <span class="p">)</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S UT&#39;</span><span class="p">),</span>
                   <span class="s">&#39;Safe&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">safe</span><span class="p">,</span>
                   <span class="s">&#39;Ambient Temperature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ambient_temp</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;Sky Temperature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sky_temp</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;Rain Frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rain_frequency</span><span class="p">,</span>
                   <span class="s">&#39;Wind Speed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;Internal Voltage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_voltage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;LDR Resistance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">LDR_resistance</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rain_sensor_temp</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                   <span class="s">&#39;PWM&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span><span class="p">,</span>
                   <span class="s">&#39;E1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;!E1&#39;</span><span class="p">],</span>
                   <span class="s">&#39;E2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;!E2&#39;</span><span class="p">],</span>
                   <span class="s">&#39;E3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;!E3&#39;</span><span class="p">],</span>
                   <span class="s">&#39;E4&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;!E4&#39;</span><span class="p">],</span>
                   <span class="s">&#39;Switch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Adding new row to table&#39;</span><span class="p">)</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Writing modified table to: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">))</span>
        <span class="n">ascii</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">telemetry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="AAGCloudSensor.make_safety_decision"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.AAGCloudSensor.make_safety_decision">[docs]</a>    <span class="k">def</span> <span class="nf">make_safety_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Method makes decision whether conditions are safe or unsafe.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">safe</span> <span class="o">=</span> <span class="s">&#39;UNSAFE&#39;</span>

</div></div>
<div class="viewcode-block" id="decimal_hours"><a class="viewcode-back" href="../../../panoptes.weather.html#panoptes.weather.AAGCloudSensor.decimal_hours">[docs]</a><span class="k">def</span> <span class="nf">decimal_hours</span><span class="p">(</span><span class="n">DTO</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">DTO</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="n">decimal</span> <span class="o">=</span> <span class="n">DTO</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">DTO</span><span class="o">.</span><span class="n">minute</span><span class="o">/</span><span class="mf">60.</span> <span class="o">+</span> <span class="n">DTO</span><span class="o">.</span><span class="n">second</span><span class="o">/</span><span class="mf">3600.</span>
    <span class="k">return</span> <span class="n">decimal</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="c">## Parse Command Line Arguments</span>
    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="c">## create a parser object for understanding command-line arguments</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
             <span class="n">description</span><span class="o">=</span><span class="s">&quot;Program description.&quot;</span><span class="p">)</span>
    <span class="c">## add flags</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-p&quot;</span><span class="p">,</span> <span class="s">&quot;--plot&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;plot&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Plot the data instead of querying new values.&quot;</span><span class="p">)</span>
    <span class="c">## add arguments</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-d&quot;</span><span class="p">,</span> <span class="s">&quot;--date&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;plotdate&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&quot;Date to plot&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="c">## Update Weather Telemetry</span>
    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="n">AAG</span> <span class="o">=</span> <span class="n">AAGCloudSensor</span><span class="p">(</span><span class="n">serial_address</span><span class="o">=</span><span class="s">&#39;/dev/ttyAMA0&#39;</span><span class="p">)</span>
        <span class="n">AAG</span><span class="o">.</span><span class="n">update_weather</span><span class="p">()</span>
        <span class="n">AAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Done.&#39;</span><span class="p">)</span>


    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="c">## Make Plots</span>
    <span class="c">##-------------------------------------------------------------------------</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
        <span class="kn">import</span> <span class="nn">ephem</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Read Telemetry</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">dummyAAG</span> <span class="o">=</span> <span class="n">AAGCloudSensor</span><span class="p">(</span><span class="n">serial_address</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">plotdate</span><span class="p">:</span>
            <span class="n">DateString</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y%m</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DateString</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">plotdate</span>
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">telemetry_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;var&#39;</span><span class="p">,</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;PanoptesWeather&#39;</span><span class="p">,</span> <span class="s">&#39;telemetry_{}UT.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DateString</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dummyAAG</span><span class="o">.</span><span class="n">telemetry_file</span><span class="p">)</span>
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Reading telemetry for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DateString</span><span class="p">))</span>
        <span class="n">telemetry</span> <span class="o">=</span> <span class="n">dummyAAG</span><span class="o">.</span><span class="n">read_AAG_telemetry</span><span class="p">()</span>

        <span class="n">time_decimal</span> <span class="o">=</span> <span class="p">[</span><span class="n">decimal_hours</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">),</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S UT&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">]]</span>
        <span class="n">time_decimal_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;hours&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">time_decimal</span><span class="p">)</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">time_decimal_column</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;  Convert temperatures to C and F&#39;</span><span class="p">)</span>
        <span class="n">ambient_temp_C</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ambient Temperature (C)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ambient_temp_C</span><span class="p">))</span>
        <span class="n">ambient_temp_F</span> <span class="o">=</span> <span class="p">[</span><span class="mf">32.</span><span class="o">+</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span><span class="o">*</span><span class="mf">1.8</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ambient Temperature (F)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ambient_temp_F</span><span class="p">))</span>

        <span class="n">sky_temp_C</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Sky Temperature (C)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sky_temp_C</span><span class="p">))</span>
        <span class="n">sky_temp_F</span> <span class="o">=</span> <span class="p">[</span><span class="mf">32.</span><span class="o">+</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span><span class="o">*</span><span class="mf">1.8</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Sky Temperature (F)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sky_temp_F</span><span class="p">))</span>

        <span class="n">RST_C</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Rain Sensor Temperature (C)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">RST_C</span><span class="p">))</span>
        <span class="n">RST_F</span> <span class="o">=</span> <span class="p">[</span><span class="mf">32.</span><span class="o">+</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">)</span><span class="o">*</span><span class="mf">1.8</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature&#39;</span><span class="p">]]</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Rain Sensor Temperature (F)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">RST_F</span><span class="p">))</span>

        <span class="n">sky_difference_C</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sky_difference_F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (C)&#39;</span><span class="p">])):</span>
            <span class="n">diff_C</span> <span class="o">=</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Temperature (C)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (C)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">diff_F</span> <span class="o">=</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Temperature (F)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (F)&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sky_difference_C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_C</span><span class="p">)</span>
            <span class="n">sky_difference_F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_F</span><span class="p">)</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Sky Difference (C)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sky_difference_C</span><span class="p">))</span>
        <span class="n">telemetry</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Sky Difference (F)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sky_difference_F</span><span class="p">))</span>


        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Use pyephem determine sunrise and sunset times</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;  Determine sunrise and sunset times&#39;</span><span class="p">)</span>
        <span class="n">Observatory</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Observer</span><span class="p">()</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="s">&quot;-155:34:33.9&quot;</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="s">&quot;+19:32:09.66&quot;</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="mf">3400.0</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="mf">10.0</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="mf">680.0</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; 10:00:00.0&quot;</span>

        <span class="n">Observatory</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="s">&#39;0.0&#39;</span>
        <span class="n">SunsetTime</span>  <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">())</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">SunriseTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">())</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">SunsetDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunsetTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunsetTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunsetTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">SunriseDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunriseTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunriseTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">SunriseTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="s">&#39;-6.0&#39;</span>
        <span class="n">EveningCivilTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">MorningCivilTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">EveningCivilTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">MorningCivilTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningCivilTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="s">&#39;-12.0&#39;</span>
        <span class="n">EveningNauticalTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">MorningNauticalTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">EveningNauticalTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">MorningNauticalTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningNauticalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="s">&#39;-18.0&#39;</span>
        <span class="n">EveningAstronomicalTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">previous_setting</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">MorningAstronomicalTwilightTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Sun</span><span class="p">(),</span> <span class="n">use_center</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">EveningAstronomicalTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">EveningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">MorningAstronomicalTwilightDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MorningAstronomicalTwilightTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>

        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;  Determine moon altitude values&#39;</span><span class="p">)</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; 0:00:01.0&quot;</span>
        <span class="n">TheMoon</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">()</span>
        <span class="n">TheMoon</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">Observatory</span><span class="p">)</span>
        <span class="n">MoonsetTime</span>  <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_setting</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">())</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">MoonriseTime</span> <span class="o">=</span> <span class="n">Observatory</span><span class="o">.</span><span class="n">next_rising</span><span class="p">(</span><span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">())</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
        <span class="n">MoonsetDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonsetTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonsetTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonsetTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>
        <span class="n">MoonriseDecimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonriseTime</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonriseTime</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">60.</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">MoonriseTime</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">))</span><span class="o">/</span><span class="mf">3600.</span>        

        <span class="n">MoonTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">MoonAlts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">MoonTime</span> <span class="ow">in</span> <span class="n">MoonTimes</span><span class="p">:</span>
            <span class="n">TimeString</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%04.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">MoonTime</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">MoonTime</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="p">((</span><span class="n">MoonTime</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">60.0</span><span class="p">)</span>
            <span class="n">Observatory</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">TimeString</span>
            <span class="n">TheMoon</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">Observatory</span><span class="p">)</span>
            <span class="n">MoonAlts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TheMoon</span><span class="o">.</span><span class="n">alt</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">ephem</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">MoonAlts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MoonAlts</span><span class="p">)</span>
    
        <span class="n">MoonPeakAlt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">MoonAlts</span><span class="p">)</span>
        <span class="n">MoonPeakTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">MoonTimes</span><span class="p">[(</span><span class="n">MoonAlts</span> <span class="o">==</span> <span class="n">MoonPeakAlt</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MoonPeakTimeString</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%04.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">MoonPeakTime</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">MoonPeakTime</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="p">((</span><span class="n">MoonPeakTime</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">60.0</span><span class="p">)</span>
        <span class="n">Observatory</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">DateString</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">MoonPeakTimeString</span>
        <span class="n">TheMoon</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">Observatory</span><span class="p">)</span>
        <span class="n">MoonPhase</span> <span class="o">=</span> <span class="n">TheMoon</span><span class="o">.</span><span class="n">phase</span>

        <span class="n">MoonFill</span> <span class="o">=</span> <span class="n">MoonPhase</span><span class="o">/</span><span class="mf">100.</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.05</span>

        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Make Plot of Entire UT Day</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;  Generate temperature plot&#39;</span><span class="p">)</span>
        <span class="n">PlotFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;var&#39;</span><span class="p">,</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;PanoptesWeather&#39;</span><span class="p">,</span> <span class="s">&#39;weather_{}UT.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DateString</span><span class="p">))</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">Figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mf">9.5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">PlotStartUT</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">PlotEndUT</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="n">nUTHours</span> <span class="o">=</span> <span class="mi">25</span>

        <span class="c">## Plot Positions</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">1.000</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mf">0.230</span>
        <span class="n">vspace</span> <span class="o">=</span> <span class="mf">0.015</span>

        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Temperatures</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">nplots</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">TemperatureAxes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">nplots</span><span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (F)&#39;</span><span class="p">],</span> <span class="s">&#39;ko-&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Rain Sensor Temperature (F)&#39;</span><span class="p">],</span> <span class="s">&#39;ro-&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Weather Data for {}/{}/{} UT&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DateString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">DateString</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Temperature (F)&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (F)&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Ambient Temperature (F)&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>

        <span class="c">## Overplot Twilights</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">SunsetDecimal</span><span class="p">,</span> <span class="n">EveningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">EveningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">EveningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">SunriseDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c">## Overplot Moon Up Time</span>
        <span class="n">MoonAxes</span> <span class="o">=</span> <span class="n">TemperatureAxes</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">MoonAxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Moon Alt (</span><span class="si">%.0f%%</span><span class="s"> full)&#39;</span> <span class="o">%</span> <span class="n">MoonPhase</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MoonTimes</span><span class="p">,</span> <span class="n">MoonAlts</span><span class="p">,</span> <span class="s">&#39;y-&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">MoonTimes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MoonAlts</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">MoonAlts</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">MoonFill</span><span class="p">)</span>        

        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Cloudiness</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">nplots</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">CloudinessAxes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">height</span><span class="o">*</span><span class="n">nplots</span><span class="o">-</span><span class="n">vspace</span><span class="o">*</span><span class="p">(</span><span class="n">nplots</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Difference (F)&#39;</span><span class="p">],</span> <span class="s">&#39;ko-&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Sky Difference (F)&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Sky Difference (F)&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">+</span><span class="mi">5</span><span class="p">)</span>

        <span class="c">## Overplot Twilights</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">SunsetDecimal</span><span class="p">,</span> <span class="n">EveningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">EveningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">EveningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">EveningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningAstronomicalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningNauticalTwilightDecimal</span><span class="p">,</span> <span class="n">MorningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">MorningCivilTwilightDecimal</span><span class="p">,</span> <span class="n">SunriseDecimal</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c">## Overplot Moon Up Time</span>
        <span class="n">MoonAxes</span> <span class="o">=</span> <span class="n">TemperatureAxes</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">MoonAxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Moon Alt (</span><span class="si">%.0f%%</span><span class="s"> full)&#39;</span> <span class="o">%</span> <span class="n">MoonPhase</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MoonTimes</span><span class="p">,</span> <span class="n">MoonAlts</span><span class="p">,</span> <span class="s">&#39;y-&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">MoonTimes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MoonAlts</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">MoonAlts</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">MoonFill</span><span class="p">)</span>        

        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Wind</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">nplots</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">WindAxes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">height</span><span class="o">*</span><span class="n">nplots</span><span class="o">-</span><span class="n">vspace</span><span class="o">*</span><span class="p">(</span><span class="n">nplots</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Wind Speed&#39;</span><span class="p">],</span> <span class="s">&#39;ko-&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Wind Speed (km/h)&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Wind Speed&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">5</span><span class="p">]))</span>

        <span class="c">##---------------------------------------------------------------------</span>
        <span class="c">## Rain</span>
        <span class="c">##---------------------------------------------------------------------</span>
        <span class="n">nplots</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c">#         print([0.0, 1.0-height*nplots-vspace*(nplots-1), 1.0, height])</span>
        <span class="n">RainAxes</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">height</span><span class="o">*</span><span class="n">nplots</span><span class="o">-</span><span class="n">vspace</span><span class="o">*</span><span class="p">(</span><span class="n">nplots</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1.00</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;LDR Resistance&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">,</span> <span class="s">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;LDR Resistance&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">],</span> <span class="n">telemetry</span><span class="p">[</span><span class="s">&#39;Rain Frequency&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1023.</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="s">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Rain Freq. (%)&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Rain/Wetness&quot;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">,</span><span class="n">nUTHours</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">PlotStartUT</span><span class="p">,</span><span class="n">PlotEndUT</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time (UT Hours)&#39;</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">)</span>


<span class="c">#         ## Overplot Twilights</span>
<span class="c">#         pyplot.axvspan(SunsetDecimal, EveningCivilTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.1)</span>
<span class="c">#         pyplot.axvspan(EveningCivilTwilightDecimal, EveningNauticalTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.2)</span>
<span class="c">#         pyplot.axvspan(EveningNauticalTwilightDecimal, EveningAstronomicalTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.3)</span>
<span class="c">#         pyplot.axvspan(EveningAstronomicalTwilightDecimal, MorningAstronomicalTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.5)</span>
<span class="c">#         pyplot.axvspan(MorningAstronomicalTwilightDecimal, MorningNauticalTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.3)</span>
<span class="c">#         pyplot.axvspan(MorningNauticalTwilightDecimal, MorningCivilTwilightDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.2)</span>
<span class="c">#         pyplot.axvspan(MorningCivilTwilightDecimal, SunriseDecimal, ymin=0, ymax=1, color=&#39;blue&#39;, alpha=0.1)</span>
<span class="c"># </span>
<span class="c">#         ## Overplot Moon Up Time</span>
<span class="c">#         MoonAxes = TemperatureAxes.twinx()</span>
<span class="c">#         MoonAxes.set_ylabel(&#39;Moon Alt (%.0f%% full)&#39; % MoonPhase, color=&#39;y&#39;)</span>
<span class="c">#         pyplot.plot(MoonTimes, MoonAlts, &#39;y-&#39;)</span>
<span class="c">#         pyplot.ylim(0,100)</span>
<span class="c">#         pyplot.yticks([10,30,50,70,90], color=&#39;y&#39;)</span>
<span class="c">#         pyplot.xticks(np.linspace(PlotStartUT,PlotEndUT,nUTHours,endpoint=True))</span>
<span class="c">#         pyplot.xlim(PlotStartUT,PlotEndUT)</span>
<span class="c">#         pyplot.fill_between(MoonTimes, 0, MoonAlts, where=MoonAlts&gt;0, color=&#39;yellow&#39;, alpha=MoonFill)        </span>


        <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">PlotFile</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.10</span><span class="p">)</span>
        <span class="n">dummyAAG</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;  Done&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">POCS 0.1.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../panoptes.html" >panoptes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Project Panoptes.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>