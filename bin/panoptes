#!/usr/bin/env python3

import os
import sys

# Append the POCS dir to the system path.
pocs_dir = os.getenv('POCS', '/var/panoptes/POCS')

sys.path.append(pocs_dir)

from panoptes.core import Panoptes

# Create the unit and start up.
pan = Panoptes()
pan.next_state = 'initializing'

print("Starting unit")

try:
    pan.run()
except KeyboardInterrupt:
    print("Received shutdown.")
except Exception as e:
    print("Problem: {}".format(e))
finally:
    try:
        pan.power_down()
    except Exception as e:
        print("Problem powering down. PLEASE MANUALLY INSPECT THE MOUNT.")
        print("Error: {}".format(e))
    finally:
        sys.exit(0)
